/**
 * Terrific JavaScript Framework v2.1.0
 * http://terrifically.org
 *
 * Copyright 2015, Remo Brunschwiler
 * @license MIT Licensed.
 *
 * Date: Thu Feb 19 2015 10:14:28
 *
 *
 * Includes:
 * Simple JavaScript Inheritance
 * By John Resig http://ejohn.org/
 * MIT Licensed.
 *
 * @module Tc
 *
 */
(function(){var a,b,c=this;a="undefined"!=typeof exports?exports:c.Tc={},b=a.$=c.jQuery||c.Zepto||c.$,this.Class||!function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.constructor=d,d.extend=arguments.callee,d}}(),a.Config={dependencies:{css:"/css/dependencies",js:"/js/dependencies"}},a.Application=Class.extend({init:function(c,d){this.config=b.extend({},a.Config,d),this.$ctx=c||b("body"),this.modules=[],this.connectors={},this.sandbox=new a.Sandbox(this,this.config)},registerModules:function(c){var d=this,e=[],f=a.Utils.String;return c=c||this.$ctx,c.find('.mod:not([data-ignore="true"])').add(c).each(function(){var c=b(this),g=c.attr("class")||"";if(g=g.split(" "),g.length>1){for(var h,i,j=[],k=[],l=0,m=g.length;m>l;l++){var n=b.trim(g[l]);n&&(n.indexOf("-")>-1&&(n=f.toCamel(n)),0===n.indexOf("mod")&&n.length>3?h=n.substr(3):0===n.indexOf("skin")&&j.push(n.substr(4).replace(h,"")))}if(i=c.attr("data-connectors")){k=i.split(",");for(var l=0,m=k.length;m>l;l++){var o=b.trim(k[l]);o&&(k[l]=o)}}h&&a.Module[h]&&e.push(d.registerModule(c,h,j,k))}}),e},unregisterModules:function(a){var c=this.connectors;if(a=a||this.modules,a===this.modules)this.connectors=[],this.modules=[];else for(var d=0,e=a.length;e>d;d++){var f,g=a[d];for(var h in c)c.hasOwnProperty(h)&&c[h].unregisterComponent(g);f=b.inArray(g,this.modules),f>-1&&delete this.modules[f]}},end:function(a){"function"==typeof a&&this.sandbox.addCallback("end",a)},start:function(a){a=a||this.modules;for(var b=0,c=a.length;c>b;b++)a[b].start()},stop:function(a){a=a||this.modules;for(var b=0,c=a.length;c>b;b++)a[b].stop()},registerModule:function(b,c,d,e){var f=this.modules;if(c=c||void 0,d=d||[],e=e||[],c&&a.Module[c]){var g=f.length;b.data("terrific-id",g),f[g]=new a.Module[c](b,this.sandbox,g);for(var h=0,i=d.length;i>h;h++){var j=d[h];a.Module[c][j]&&(f[g]=f[g].getDecoratedModule(c,j))}for(var h=0,i=e.length;i>h;h++)this.registerConnection(e[h],f[g]);return f[g]}return null},registerConnection:function(c,d){c=b.trim(c);var e,f,g,h=c.split("-");if(1===h.length?g=f=h[0]:2===h.length&&(e=h[0],f=h[1],g=e+f),g){var i=this.connectors;i[g]||(e?a.Connector[e]&&(i[g]=new a.Connector[e](f)):i[g]=new a.Connector(f)),i[g]&&(d.attachConnector(i[g]),i[g].registerComponent(d))}},unregisterConnection:function(a,b){var c=this.connectors[a];c&&(c.unregisterComponent(b),b.detachConnector(c))}}),a.Sandbox=Class.extend({init:function(a,b){this.application=a,this.config=b,this.hooks={after:[],end:[]}},addModules:function(a){var b=[],c=this.application;return a&&(b=c.registerModules(a),c.start(b)),b},removeModules:function(a){var c=this,d=this.application;if(!b.isArray(a)){var e=a,f=[];e.find(".mod").add(e).each(function(){var a=b(this).data("terrific-id");if(void 0!==a){var d=c.getModuleById(a);d&&f.push(d)}}),a=f}a&&(d.stop(a),d.unregisterModules(a))},subscribe:function(b,c){var d=this.application;if(b+="",!c||!b)throw new Error("subscribe is expecting 2 parameters (connector, module)");if(!(c instanceof a.Module))throw new Error("the module param must be an instance of Tc.Module");d.registerConnection(b,c)},unsubscribe:function(b,c){var d=this.application;c instanceof a.Module&&b&&(b+="",d.unregisterConnection(b,c))},getModuleById:function(a){var b=this.application;if(void 0!==b.modules[a])return b.modules[a];throw new Error("the module with the id "+a+" does not exist")},getConfig:function(){return this.config},getConfigParam:function(a){var b=this.config;if(void 0!==b[a])return b[a];throw new Error("the config param "+a+" does not exist")},addCallback:function(a,b){null==b&&(a="end"),this.hooks[a].push(b)},ready:function(a){var b=this.hooks.after;if(b.push(a),this.application.modules.length===b.length){for(var c=0;c<b.length;c++){var d=b[c];"function"==typeof d&&(delete b[c],d())}for(var e=this.hooks.end,c=0;c<e.length;c++){var f=e[c];"function"==typeof f&&f()}}}}),a.Module=Class.extend({init:function(a,b,c){this.$ctx=a,this.id=c,this.connectors={},this.sandbox=b},start:function(){var a=this;this.on&&this.on(function(){a.initAfter()})},stop:function(){var a=this.$ctx;b("*",a).unbind().removeData(),a.unbind().removeData()},initAfter:function(){var a=this;this.sandbox.ready(function(){a.after&&a.after()})},fire:function(c,d,e,f){var g=this,h=this.connectors,i=!0;null==e&&null==f?"function"==typeof d?(f=d,d=void 0):b.isArray(d)&&(e=d,d=void 0):null==f&&("function"==typeof e&&(f=e,e=void 0),b.isArray(d)&&(e=d,d=void 0)),c=a.Utils.String.capitalize(c),d=d||{},e=e||Object.keys(h);for(var j=0,k=e.length;k>j;j++){var l=e[j];if(!h.hasOwnProperty(l))throw new Error("the module #"+g.id+" is not connected to connector "+l+" â€“ hint: please make sure that your data is an object and not an array");var m=h[l],n=m.notify(g,"on"+c,d)||!1;n||(i=!1)}i&&"function"==typeof f&&f(d)},attachConnector:function(a){this.connectors[a.connectorId]=a},detachConnector:function(a){delete this.connectors[a.connectorId]},getDecoratedModule:function(b,c){if(a.Module[b][c]){var d=a.Module[b][c];return d.prototype=this,d.prototype.constructor=a.Module[b][c],new d(this)}return null}}),a.Connector=Class.extend({init:function(a){this.connectorId=a,this.components={}},registerComponent:function(a){this.components[a.id]={component:a}},unregisterComponent:function(a){var b=this.components;b[a.id]&&delete b[a.id]},notify:function(a,b,c){var d=!0,e=this.components;for(var f in e)if(e.hasOwnProperty(f)){var g=e[f].component;g!==a&&g[b]&&g[b](c)===!1&&(d=!1)}return d}}),a.Utils={},Object.keys||(Object.keys=function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b);return c}),a.Utils.String={capitalize:function(a){return a.substr(0,1).toUpperCase().concat(a.substr(1))},toCamel:function(a){return a.replace(/(\-[A-Za-z])/g,function(a){return a.toUpperCase().replace("-","")})}}}).call(this);